<!DOCTYPE html>
<html>
    <head>
        <title>Trip Cruncher</title>
        <link rel="stylesheet" href="/vendors/bootstrap.min.css">
        <link rel="stylesheet" href="/styles/style.css">

        <script type="text/javascript" src="/vendors/angular.min.js"></script>
        <script type="text/javascript" src="/vendors/ui-bootstrap-tpls-1.3.3.min.js"></script>
        <script type="text/javascript" src="/vendors/angular-route.min.js"></script>
        <script type="text/javascript" src="/vendors/moment.min.js"></script>
        <script type="text/javascript" src="/scripts/clientapp.js"></script>
        <script type="text/javascript" src="/scripts/factories/dataFactory.js"></script>
        <script type="text/javascript" src="/scripts/controllers/loginController.js"></script>
        <script type="text/javascript" src="/scripts/controllers/userController.js"></script>
        <script type="text/javascript" src="/scripts/controllers/headerController.js"></script>
        <script type="text/javascript" src="/scripts/controllers/newTripController.js"></script>
        <script type="text/javascript" src="/scripts/controllers/costsController.js"></script>
        <script type="text/javascript" src="/scripts/controllers/groceriesController.js"></script>
        <script type="text/javascript" src="/scripts/controllers/currentTripController.js"></script>
        <script type="text/javascript" src="/scripts/controllers/itineraryController.js"></script>
        <script type="text/javascript" src="/scripts/controllers/mealsController.js"></script>
        <script type="text/javascript" src="/scripts/controllers/notesController.js"></script>
        <script type="text/javascript" src="/scripts/controllers/packController.js"></script>
        <script>
            myApp.controller('Background', ['$scope','$http', '$window', '$location', 'DataFactory', function($scope, $http, $window, $location, DataFactory) {
              //console.log('bg controller');
              $scope.dataFactory = DataFactory;
              $scope.first_name = undefined;
              $scope.loggedIn = '';

              loadLogin();

              function loadLogin () {
              if($scope.dataFactory.factoryCurrentUser() === undefined) {
                  $scope.dataFactory.factoryRefreshUser().then(function() {
                    $scope.first_name = $scope.dataFactory.factoryCurrentUser();
                    if ($scope.dataFactory.factoryCurrentUser() === undefined) {
                      $scope.loggedIn = false;
                      //console.log($scope.loggedIn);
                    }
                    else {
                      $scope.first_name = $scope.dataFactory.factoryCurrentUser();
                      $scope.loggedIn = true;
                      //console.log($scope.loggedIn);
                    }
                  });
                } else {
                  $scope.first_name = $scope.dataFactory.factoryCurrentUser();
                  $scope.loggedIn = true;
                  //console.log($scope.loggedIn);
                }
              }

            }]);
        </script>

    </head>


        <body ng-app="myApp" ng-controller="Background" ng-class="{'bodyBackground' : loggedIn}">
          <header ng-include="'/views/templates/header.html'"></header>

          <main ng-view></main>

        </body>
</html>
